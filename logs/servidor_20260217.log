[2026-02-17 09:54:27] ============================================================
[2026-02-17 09:54:27] Servidor MCP Modular iniciado
[2026-02-17 09:54:27] Directorio de herramientas: C:\Users\frpoz\mcp\herramientas
[2026-02-17 09:54:27] Directorio de logs: C:\Users\frpoz\mcp\logs
[2026-02-17 09:54:27] Buscando herramientas en: C:\Users\frpoz\mcp\herramientas
[2026-02-17 09:54:27] Encontrados 6 archivos
[2026-02-17 09:54:27] Herramienta cargada: FR_generar_herramienta
[2026-02-17 09:54:27] Herramienta cargada: FR_listar_herramientas_creadas
[2026-02-17 09:54:27] ERROR cargando FR_renombrar_familias2_rfa.py: unterminated string literal (detected at line 846) (FR_renombrar_familias2_rfa.py, line 846)
[2026-02-17 09:54:27] Herramienta cargada: FR_renombrar_familias_rfa
[2026-02-17 09:54:27] Herramienta cargada: FR_FR_renombrar_mayusculas_v2
[2026-02-17 09:54:27] Herramienta cargada: FR_renombrar_mayusculas
[2026-02-17 09:54:27] Cargadas 5 herramientas exitosamente
[2026-02-17 09:54:27] Total herramientas cargadas: 5
[2026-02-17 09:54:27]   - FR_generar_herramienta
[2026-02-17 09:54:27]   - FR_listar_herramientas_creadas
[2026-02-17 09:54:27]   - FR_renombrar_familias_rfa
[2026-02-17 09:54:27]   - FR_FR_renombrar_mayusculas_v2
[2026-02-17 09:54:27]   - FR_renombrar_mayusculas
[2026-02-17 09:54:27] Buscando herramientas en: C:\Users\frpoz\mcp\herramientas
[2026-02-17 09:54:27] Encontrados 6 archivos
[2026-02-17 09:54:27] Herramienta cargada: FR_generar_herramienta
[2026-02-17 09:54:27] Herramienta cargada: FR_listar_herramientas_creadas
[2026-02-17 09:54:27] ERROR cargando FR_renombrar_familias2_rfa.py: unterminated string literal (detected at line 846) (FR_renombrar_familias2_rfa.py, line 846)
[2026-02-17 09:54:27] Herramienta cargada: FR_renombrar_familias_rfa
[2026-02-17 09:54:27] Herramienta cargada: FR_FR_renombrar_mayusculas_v2
[2026-02-17 09:54:27] Herramienta cargada: FR_renombrar_mayusculas
[2026-02-17 09:54:27] Cargadas 5 herramientas exitosamente
[2026-02-17 09:54:27] Listando 5 herramientas
[2026-02-17 14:02:48] ============================================================
[2026-02-17 14:02:48] Servidor MCP Modular iniciado
[2026-02-17 14:02:48] Directorio de herramientas: C:\Users\frpoz\mcp\herramientas
[2026-02-17 14:02:48] Directorio de logs: C:\Users\frpoz\mcp\logs
[2026-02-17 14:02:48] Buscando herramientas en: C:\Users\frpoz\mcp\herramientas
[2026-02-17 14:02:48] Encontrados 6 archivos
[2026-02-17 14:02:48] Herramienta cargada: FR_generar_herramienta
[2026-02-17 14:02:48] Herramienta cargada: FR_listar_herramientas_creadas
[2026-02-17 14:02:49] ERROR cargando FR_renombrar_familias2_rfa.py: unterminated string literal (detected at line 846) (FR_renombrar_familias2_rfa.py, line 846)
[2026-02-17 14:02:49] Herramienta cargada: FR_renombrar_familias_rfa
[2026-02-17 14:02:49] Herramienta cargada: FR_FR_renombrar_mayusculas_v2
[2026-02-17 14:02:49] Herramienta cargada: FR_renombrar_mayusculas
[2026-02-17 14:02:49] Cargadas 5 herramientas exitosamente
[2026-02-17 14:02:49] Total herramientas cargadas: 5
[2026-02-17 14:02:49]   - FR_generar_herramienta
[2026-02-17 14:02:49]   - FR_listar_herramientas_creadas
[2026-02-17 14:02:49]   - FR_renombrar_familias_rfa
[2026-02-17 14:02:49]   - FR_FR_renombrar_mayusculas_v2
[2026-02-17 14:02:49]   - FR_renombrar_mayusculas
[2026-02-17 14:02:54] Buscando herramientas en: C:\Users\frpoz\mcp\herramientas
[2026-02-17 14:02:54] Encontrados 6 archivos
[2026-02-17 14:02:54] Herramienta cargada: FR_generar_herramienta
[2026-02-17 14:02:54] Herramienta cargada: FR_listar_herramientas_creadas
[2026-02-17 14:02:54] ERROR cargando FR_renombrar_familias2_rfa.py: unterminated string literal (detected at line 846) (FR_renombrar_familias2_rfa.py, line 846)
[2026-02-17 14:02:54] Herramienta cargada: FR_renombrar_familias_rfa
[2026-02-17 14:02:54] Herramienta cargada: FR_FR_renombrar_mayusculas_v2
[2026-02-17 14:02:54] Herramienta cargada: FR_renombrar_mayusculas
[2026-02-17 14:02:54] Cargadas 5 herramientas exitosamente
[2026-02-17 14:02:54] Listando 5 herramientas
[2026-02-17 19:54:43] Ejecutando: FR_generar_herramienta con args: {'nombre': 'actualizar_familias_revit_dynamo', 'descripcion': 'Busca familias RFA en un directorio, abre Revit con Dynamo Multiplayer, las actualiza por lotes, cierra Revit y renombra los archivos con nomenclatura en español (Primera letra mayúscula, resto minúsculas)', 'parametros': [{'nombre': 'ruta_base', 'tipo': 'string', 'descripcion': 'Ruta del directorio base donde buscar archivos .rfa', 'requerido': False}], 'codigo_funcion': '\nimport os\nimport subprocess\nimport tkinter as tk\nfrom tkinter import filedialog\nfrom pathlib import Path\nimport time\nimport re\nfrom anthropic import Anthropic\n\ndef normalizar_nombre_español(nombre):\n    """Convierte nombre a formato: Primera letra mayúscula, resto minúsculas"""\n    # Eliminar extensión\n    nombre_sin_ext = nombre.rsplit(\'.\', 1)[0] if \'.\' in nombre else nombre\n    # Primera letra mayúscula, resto minúsculas\n    nombre_normalizado = nombre_sin_ext[0].upper() + nombre_sin_ext[1:].lower() if nombre_sin_ext else ""\n    return nombre_normalizado\n\ndef buscar_archivos_rfa(ruta_base=None):\n    """Busca archivos .rfa en directorio y subdirectorios"""\n    if not ruta_base:\n        root = tk.Tk()\n        root.withdraw()\n        ruta_base = filedialog.askdirectory(title="Selecciona la carpeta con archivos RFA")\n    \n    if not ruta_base:\n        return [], ruta_base\n    \n    archivos_rfa = []\n    for root, dirs, files in os.walk(ruta_base):\n        for file in files:\n            if file.lower().endswith(\'.rfa\'):\n                ruta_completa = os.path.join(root, file)\n                archivos_rfa.append(ruta_completa)\n    \n    return archivos_rfa, ruta_base\n\ndef abrir_revit_con_dynamo(archivos_rfa):\n    """Abre Revit y usa Dynamo Multiplayer para actualizar familias"""\n    print(f"[INFO] Se encontraron {len(archivos_rfa)} archivos RFA")\n    for archivo in archivos_rfa:\n        print(f"  - {archivo}")\n    \n    # Crear script de Dynamo (pseudocódigo)\n    lista_archivos = "\\n".join(archivos_rfa)\n    \n    print("\\n[PASO 1] Abriendo Revit...")\n    \n    # Buscar ruta de Revit (típicamente en C:\\Program Files\\Autodesk\\Revit...)\n    revit_paths = [\n        r"C:\\Program Files\\Autodesk\\Revit 2026\\Revit.exe",\n        r"C:\\Program Files\\Autodesk\\Revit 2025\\Revit.exe",\n        r"C:\\Program Files\\Autodesk\\Revit 2024\\Revit.exe",\n    ]\n    \n    revit_exe = None\n    for path in revit_paths:\n        if os.path.exists(path):\n            revit_exe = path\n            break\n    \n    if not revit_exe:\n        print("[ERROR] No se encontró Revit instalado")\n        return False\n    \n    print(f"[INFO] Revit encontrado: {revit_exe}")\n    \n    # Abrir Revit\n    try:\n        subprocess.Popen([revit_exe])\n        print("[INFO] Revit abierto. Espera a que se cargue...")\n        time.sleep(15)  # Esperar a que Revit cargue\n        \n        print("\\n[PASO 2] Manualmente en Revit:")\n        print("  1. Abre el complemento \'Dynamo Multiplayer v.3.0\'")\n        print("  2. Pega la siguiente lista de archivos:")\n        print(f"\\n{lista_archivos}\\n")\n        print("  3. Ejecuta el proceso de actualización")\n        print("  4. Cierra Revit cuando termine")\n        \n        input("\\nPresiona ENTER cuando hayas terminado en Revit y lo hayas cerrado...")\n        \n        return True\n    except Exception as e:\n        print(f"[ERROR] No se pudo abrir Revit: {e}")\n        return False\n\ndef renombrar_archivos(archivos_rfa):\n    """Renombra archivos RFA con nomenclatura en español"""\n    print("\\n[PASO 3] Renombrando archivos...")\n    \n    cambios = []\n    for ruta_completa in archivos_rfa:\n        directorio = os.path.dirname(ruta_completa)\n        nombre_original = os.path.basename(ruta_completa)\n        \n        # Normalizar nombre\n        nombre_nuevo = normalizar_nombre_español(nombre_original) + ".rfa"\n        \n        if nombre_original != nombre_nuevo:\n            ruta_nueva = os.path.join(directorio, nombre_nuevo)\n            try:\n                if os.path.exists(ruta_nueva):\n                    print(f"[AVISO] {nombre_nuevo} ya existe, omitiendo...")\n                else:\n                    os.rename(ruta_completa, ruta_nueva)\n                    cambios.append((nombre_original, nombre_nuevo))\n                    print(f"  ✓ {nombre_original} → {nombre_nuevo}")\n            except Exception as e:\n                print(f"  ✗ Error renombrando {nombre_original}: {e}")\n    \n    return cambios\n\ndef main(ruta_base=None):\n    """Función principal"""\n    print("=" * 60)\n    print("ACTUALIZADOR DE FAMILIAS REVIT CON DYNAMO MULTIPLAYER")\n    print("=" * 60)\n    \n    # Paso 1: Buscar archivos RFA\n    archivos_rfa, ruta_usada = buscar_archivos_rfa(ruta_base)\n    \n    if not archivos_rfa:\n        print("[ERROR] No se encontraron archivos RFA")\n        return\n    \n    print(f"\\n[ÉXITO] Se encontraron {len(archivos_rfa)} archivos RFA en:")\n    print(f"  {ruta_usada}")\n    \n    # Paso 2: Abrir Revit con Dynamo\n    if not abrir_revit_con_dynamo(archivos_rfa):\n        print("[CANCELADO] Operación cancelada")\n        return\n    \n    # Paso 3: Renombrar archivos\n    cambios = renombrar_archivos(archivos_rfa)\n    \n    print("\\n" + "=" * 60)\n    print(f"[RESUMEN] Se renombraron {len(cambios)} archivos")\n    print("=" * 60)\n\nif __name__ == "__main__":\n    main()\n'}
[2026-02-17 19:54:43] Herramienta creada: FR_actualizar_familias_revit_dynamo -> C:\Users\frpoz\mcp\herramientas\fr_actualizar_familias_revit_dynamo.py
[2026-02-17 19:54:43] Ejecucion exitosa: FR_generar_herramienta
[2026-02-17 19:58:38] Ejecutando: FR_generar_herramienta con args: {'codigo_funcion': '\nimport os\nimport subprocess\nimport tkinter as tk\nfrom tkinter import filedialog\nfrom pathlib import Path\nimport time\nimport pyautogui\nimport pyperclip\nfrom datetime import datetime\n\ndef normalizar_nombre_español(nombre):\n    """Convierte nombre a formato: Primera letra mayúscula, resto minúsculas"""\n    nombre_sin_ext = nombre.rsplit(\'.\', 1)[0] if \'.\' in nombre else nombre\n    nombre_normalizado = nombre_sin_ext[0].upper() + nombre_sin_ext[1:].lower() if nombre_sin_ext else ""\n    return nombre_normalizado\n\ndef buscar_archivos_rfa(ruta_base=None):\n    """Busca archivos .rfa en directorio y subdirectorios"""\n    if not ruta_base:\n        root = tk.Tk()\n        root.withdraw()\n        ruta_base = filedialog.askdirectory(title="Selecciona la carpeta con archivos RFA")\n    \n    if not ruta_base:\n        return [], ruta_base\n    \n    archivos_rfa = []\n    for root, dirs, files in os.walk(ruta_base):\n        for file in files:\n            if file.lower().endswith(\'.rfa\'):\n                ruta_completa = os.path.join(root, file)\n                archivos_rfa.append(ruta_completa)\n    \n    return sorted(archivos_rfa), ruta_base\n\ndef crear_lista_archivos(archivos_rfa):\n    """Crea lista de archivos en formato texto para copiar"""\n    return "\\n".join(archivos_rfa)\n\ndef abrir_revit(timeout=30):\n    """Abre Revit y espera a que cargue completamente"""\n    print("[PASO 1] Abriendo Revit...")\n    \n    revit_paths = [\n        r"C:\\Program Files\\Autodesk\\Revit 2026\\Revit.exe",\n        r"C:\\Program Files\\Autodesk\\Revit 2025\\Revit.exe",\n        r"C:\\Program Files\\Autodesk\\Revit 2024\\Revit.exe",\n    ]\n    \n    revit_exe = None\n    for path in revit_paths:\n        if os.path.exists(path):\n            revit_exe = path\n            break\n    \n    if not revit_exe:\n        print("[ERROR] No se encontró Revit instalado")\n        return None\n    \n    print(f"[INFO] Revit encontrado: {revit_exe}")\n    \n    try:\n        proceso = subprocess.Popen([revit_exe])\n        print(f"[INFO] Revit iniciado (PID: {proceso.pid}). Esperando {timeout} segundos...")\n        time.sleep(timeout)\n        return proceso\n    except Exception as e:\n        print(f"[ERROR] No se pudo abrir Revit: {e}")\n        return None\n\ndef esperar_ventana_dynamo(timeout=20):\n    """Espera a que aparezca la ventana de Dynamo Multiplayer"""\n    print("[PASO 2] Esperando ventana de Dynamo Multiplayer...")\n    \n    inicio = time.time()\n    while time.time() - inicio < timeout:\n        try:\n            # Buscar ventana de Dynamo Multiplayer\n            ventanas = pyautogui.getAllWindows()\n            for ventana in ventanas:\n                if "Dynamo Multiplayer" in ventana.title:\n                    print(f"[INFO] Ventana encontrada: {ventana.title}")\n                    ventana.activate()\n                    time.sleep(1)\n                    return True\n        except:\n            pass\n        time.sleep(0.5)\n    \n    print("[AVISO] Ventana no encontrada automáticamente, continuando...")\n    return False\n\ndef introducir_lista_automaticamente(lista_archivos):\n    """Introduce la lista de archivos en Dynamo Multiplayer automáticamente"""\n    print("[PASO 3] Introduciendo lista de archivos...")\n    \n    try:\n        # Copiar lista al portapapeles\n        pyperclip.copy(lista_archivos)\n        print("[INFO] Lista copiada al portapapeles")\n        \n        time.sleep(0.5)\n        \n        # Hacer clic en el área de texto de "List of Revit files to be batch processed"\n        # Coordenadas aproximadas según la imagen (ajustables)\n        print("[INFO] Haciendo clic en el área de entrada...")\n        pyautogui.click(610, 300)\n        time.sleep(0.5)\n        \n        # Seleccionar todo y pegar\n        pyautogui.hotkey(\'ctrl\', \'a\')\n        time.sleep(0.3)\n        pyautogui.hotkey(\'ctrl\', \'v\')\n        time.sleep(1)\n        \n        print("[INFO] Lista introducida correctamente")\n        return True\n    except Exception as e:\n        print(f"[ERROR] Error al introducir lista: {e}")\n        return False\n\ndef hacer_clic_proceder():\n    """Hace clic en el botón \'Proceed\'"""\n    print("[PASO 4] Ejecutando proceso...")\n    \n    try:\n        # Botón Proceed está aproximadamente en estas coordenadas\n        pyautogui.click(793, 769)\n        print("[INFO] Botón \'Proceed\' clickeado")\n        time.sleep(2)\n        return True\n    except Exception as e:\n        print(f"[ERROR] Error al hacer clic en Proceed: {e}")\n        return False\n\ndef esperar_procesamiento(timeout=600):\n    """Espera a que termine el procesamiento (máx 10 minutos)"""\n    print(f"[PASO 5] Procesando archivos (máx {timeout} segundos)...")\n    \n    inicio = time.time()\n    while time.time() - inicio < timeout:\n        try:\n            # Detectar si el botón "Proceed" desaparece o cambia\n            ventanas = pyautogui.getAllWindows()\n            dynamo_visible = any("Dynamo Multiplayer" in v.title for v in ventanas)\n            \n            if not dynamo_visible:\n                print("[INFO] Ventana de Dynamo cerrada - procesamiento completado")\n                return True\n                \n        except:\n            pass\n        \n        tiempo_transcurrido = int(time.time() - inicio)\n        if tiempo_transcurrido % 10 == 0:\n            print(f"[INFO] Procesando... {tiempo_transcurrido}s")\n        \n        time.sleep(1)\n    \n    print("[AVISO] Timeout alcanzado, continuando...")\n    return True\n\ndef cerrar_revit_automaticamente():\n    """Cierra Revit automáticamente"""\n    print("[PASO 6] Cerrando Revit...")\n    \n    try:\n        # Enviar Alt+F4 para cerrar la ventana activa\n        pyautogui.hotkey(\'alt\', \'F4\')\n        time.sleep(1)\n        \n        # Si aparece diálogo de guardar, presionar "No" (tabulador + Enter)\n        pyautogui.press(\'tab\')\n        time.sleep(0.3)\n        pyautogui.press(\'enter\')\n        time.sleep(2)\n        \n        print("[INFO] Revit cerrado")\n        return True\n    except Exception as e:\n        print(f"[AVISO] Error al cerrar Revit: {e}")\n        # Intentar con taskkill\n        try:\n            os.system(\'taskkill /F /IM Revit.exe\')\n            print("[INFO] Revit forzosamente cerrado")\n            time.sleep(2)\n            return True\n        except:\n            return False\n\ndef renombrar_archivos(archivos_rfa):\n    """Renombra archivos RFA con nomenclatura en español"""\n    print("\\n[PASO 7] Renombrando archivos...")\n    \n    cambios = []\n    for ruta_completa in archivos_rfa:\n        directorio = os.path.dirname(ruta_completa)\n        nombre_original = os.path.basename(ruta_completa)\n        \n        nombre_nuevo = normalizar_nombre_español(nombre_original) + ".rfa"\n        \n        if nombre_original != nombre_nuevo:\n            ruta_nueva = os.path.join(directorio, nombre_nuevo)\n            try:\n                if os.path.exists(ruta_nueva):\n                    print(f"[AVISO] {nombre_nuevo} ya existe, omitiendo...")\n                else:\n                    os.rename(ruta_completa, ruta_nueva)\n                    cambios.append((nombre_original, nombre_nuevo))\n                    print(f"  ✓ {nombre_original} → {nombre_nuevo}")\n            except Exception as e:\n                print(f"  ✗ Error renombrando {nombre_original}: {e}")\n    \n    return cambios\n\ndef main(ruta_base=None):\n    """Función principal - Automatización completa"""\n    print("=" * 70)\n    print("ACTUALIZADOR AUTOMÁTICO DE FAMILIAS REVIT - DYNAMO MULTIPLAYER v.3.0")\n    print("=" * 70)\n    \n    # Buscar archivos RFA\n    archivos_rfa, ruta_usada = buscar_archivos_rfa(ruta_base)\n    \n    if not archivos_rfa:\n        print("[ERROR] No se encontraron archivos RFA")\n        return\n    \n    print(f"\\n[ÉXITO] Se encontraron {len(archivos_rfa)} archivos RFA")\n    print(f"Ubicación: {ruta_usada}\\n")\n    \n    for archivo in archivos_rfa[:5]:  # Mostrar primeros 5\n        print(f"  - {os.path.basename(archivo)}")\n    if len(archivos_rfa) > 5:\n        print(f"  ... y {len(archivos_rfa) - 5} más\\n")\n    \n    # Crear lista\n    lista_archivos = crear_lista_archivos(archivos_rfa)\n    \n    # Abrir Revit\n    proceso_revit = abrir_revit(timeout=40)\n    if not proceso_revit:\n        print("[CANCELADO] No se pudo abrir Revit")\n        return\n    \n    # Esperar a Dynamo Multiplayer\n    esperar_ventana_dynamo(timeout=30)\n    time.sleep(2)\n    \n    # Introducir lista automáticamente\n    if not introducir_lista_automaticamente(lista_archivos):\n        print("[AVISO] Problema al introducir lista, continuando manualmente...")\n    \n    time.sleep(1)\n    \n    # Hacer clic en Proceed\n    if not hacer_clic_proceder():\n        print("[AVISO] Problema al ejecutar, verifica manualmente")\n        return\n    \n    # Esperar procesamiento\n    esperar_procesamiento(timeout=600)\n    \n    # Cerrar Revit\n    time.sleep(5)\n    cerrar_revit_automaticamente()\n    \n    # Renombrar archivos\n    cambios = renombrar_archivos(archivos_rfa)\n    \n    # Resumen final\n    print("\\n" + "=" * 70)\n    print(f"[RESUMEN] Proceso completado")\n    print(f"  - Archivos procesados: {len(archivos_rfa)}")\n    print(f"  - Archivos renombrados: {len(cambios)}")\n    print(f"  - Hora finalización: {datetime.now().strftime(\'%H:%M:%S\')}")\n    print("=" * 70)\n\nif __name__ == "__main__":\n    main()\n', 'descripcion': 'Automatización completa: busca RFA, abre Revit, introduce lista automáticamente en Dynamo Multiplayer v.3.0, ejecuta proceso, cierra Revit y renombra archivos. Todo sin intervención manual.', 'nombre': 'revit_dynamo_automatizado_completo', 'parametros': [{'nombre': 'ruta_base', 'tipo': 'string', 'descripcion': 'Ruta del directorio base (opcional)', 'requerido': False}]}
[2026-02-17 19:58:38] Herramienta creada: FR_revit_dynamo_automatizado_completo -> C:\Users\frpoz\mcp\herramientas\fr_revit_dynamo_automatizado_completo.py
[2026-02-17 19:58:38] Ejecucion exitosa: FR_generar_herramienta
[2026-02-17 20:00:07] Ejecutando: FR_generar_herramienta con args: {'codigo_funcion': '\nimport os\nimport subprocess\nimport tkinter as tk\nfrom tkinter import filedialog\nfrom pathlib import Path\nimport time\nimport pyautogui\nimport pyperclip\nfrom datetime import datetime\n\ndef normalizar_nombre_español(nombre):\n    """Convierte nombre a formato: Primera letra mayúscula, resto minúsculas"""\n    nombre_sin_ext = nombre.rsplit(\'.\', 1)[0] if \'.\' in nombre else nombre\n    nombre_normalizado = nombre_sin_ext[0].upper() + nombre_sin_ext[1:].lower() if nombre_sin_ext else ""\n    return nombre_normalizado\n\ndef buscar_archivos_rfa(ruta_base=None):\n    """Busca archivos .rfa en directorio y subdirectorios"""\n    if not ruta_base:\n        root = tk.Tk()\n        root.withdraw()\n        ruta_base = filedialog.askdirectory(title="Selecciona la carpeta con archivos RFA")\n    \n    if not ruta_base:\n        return [], ruta_base\n    \n    archivos_rfa = []\n    for root, dirs, files in os.walk(ruta_base):\n        for file in files:\n            if file.lower().endswith(\'.rfa\'):\n                ruta_completa = os.path.join(root, file)\n                archivos_rfa.append(ruta_completa)\n    \n    return sorted(archivos_rfa), ruta_base\n\ndef crear_lista_archivos(archivos_rfa):\n    """Crea lista de archivos en formato texto para copiar"""\n    return "\\n".join(archivos_rfa)\n\ndef abrir_revit(timeout=30):\n    """Abre Revit y espera a que cargue completamente"""\n    print("[PASO 1] Abriendo Revit...")\n    \n    revit_paths = [\n        r"C:\\Program Files\\Autodesk\\Revit 2026\\Revit.exe",\n        r"C:\\Program Files\\Autodesk\\Revit 2025\\Revit.exe",\n        r"C:\\Program Files\\Autodesk\\Revit 2024\\Revit.exe",\n    ]\n    \n    revit_exe = None\n    for path in revit_paths:\n        if os.path.exists(path):\n            revit_exe = path\n            break\n    \n    if not revit_exe:\n        print("[ERROR] No se encontró Revit instalado")\n        return None\n    \n    print(f"[INFO] Revit encontrado: {revit_exe}")\n    \n    try:\n        proceso = subprocess.Popen([revit_exe])\n        print(f"[INFO] Revit iniciado (PID: {proceso.pid}). Esperando {timeout} segundos...")\n        time.sleep(timeout)\n        return proceso\n    except Exception as e:\n        print(f"[ERROR] No se pudo abrir Revit: {e}")\n        return None\n\ndef esperar_ventana_dynamo(timeout=20):\n    """Espera a que aparezca la ventana de Dynamo Multiplayer"""\n    print("[PASO 2] Esperando ventana de Dynamo Multiplayer...")\n    \n    inicio = time.time()\n    while time.time() - inicio < timeout:\n        try:\n            # Buscar ventana de Dynamo Multiplayer\n            ventanas = pyautogui.getAllWindows()\n            for ventana in ventanas:\n                if "Dynamo Multiplayer" in ventana.title:\n                    print(f"[INFO] Ventana encontrada: {ventana.title}")\n                    ventana.activate()\n                    time.sleep(1)\n                    return True\n        except:\n            pass\n        time.sleep(0.5)\n    \n    print("[AVISO] Ventana no encontrada automáticamente, continuando...")\n    return False\n\ndef introducir_lista_automaticamente(lista_archivos):\n    """Introduce la lista de archivos en Dynamo Multiplayer automáticamente"""\n    print("[PASO 3] Introduciendo lista de archivos...")\n    \n    try:\n        # Copiar lista al portapapeles\n        pyperclip.copy(lista_archivos)\n        print("[INFO] Lista copiada al portapapeles")\n        \n        time.sleep(0.5)\n        \n        # Hacer clic en el área de texto de "List of Revit files to be batch processed"\n        # Coordenadas aproximadas según la imagen (ajustables)\n        print("[INFO] Haciendo clic en el área de entrada...")\n        pyautogui.click(610, 300)\n        time.sleep(0.5)\n        \n        # Seleccionar todo y pegar\n        pyautogui.hotkey(\'ctrl\', \'a\')\n        time.sleep(0.3)\n        pyautogui.hotkey(\'ctrl\', \'v\')\n        time.sleep(1)\n        \n        print("[INFO] Lista introducida correctamente")\n        return True\n    except Exception as e:\n        print(f"[ERROR] Error al introducir lista: {e}")\n        return False\n\ndef hacer_clic_proceder():\n    """Hace clic en el botón \'Proceed\'"""\n    print("[PASO 4] Ejecutando proceso...")\n    \n    try:\n        # Botón Proceed está aproximadamente en estas coordenadas\n        pyautogui.click(793, 769)\n        print("[INFO] Botón \'Proceed\' clickeado")\n        time.sleep(2)\n        return True\n    except Exception as e:\n        print(f"[ERROR] Error al hacer clic en Proceed: {e}")\n        return False\n\ndef esperar_procesamiento(timeout=3600):\n    """Espera a que termine el procesamiento (máx 60 minutos)"""\n    print(f"[PASO 5] Procesando archivos (máx {timeout//60} minutos)...")\n    \n    inicio = time.time()\n    while time.time() - inicio < timeout:\n        try:\n            # Detectar si el botón "Proceed" desaparece o cambia\n            ventanas = pyautogui.getAllWindows()\n            dynamo_visible = any("Dynamo Multiplayer" in v.title for v in ventanas)\n            \n            if not dynamo_visible:\n                print("[INFO] Ventana de Dynamo cerrada - procesamiento completado")\n                return True\n                \n        except:\n            pass\n        \n        tiempo_transcurrido = int(time.time() - inicio)\n        if tiempo_transcurrido % 30 == 0:\n            minutos = tiempo_transcurrido // 60\n            segundos = tiempo_transcurrido % 60\n            print(f"[INFO] Procesando... {minutos}m {segundos}s")\n        \n        time.sleep(1)\n    \n    print("[AVISO] Timeout de 60 minutos alcanzado, continuando...")\n    return True\n\ndef cerrar_revit_automaticamente():\n    """Cierra Revit automáticamente"""\n    print("[PASO 6] Cerrando Revit...")\n    \n    try:\n        # Enviar Alt+F4 para cerrar la ventana activa\n        pyautogui.hotkey(\'alt\', \'F4\')\n        time.sleep(1)\n        \n        # Si aparece diálogo de guardar, presionar "No" (tabulador + Enter)\n        pyautogui.press(\'tab\')\n        time.sleep(0.3)\n        pyautogui.press(\'enter\')\n        time.sleep(2)\n        \n        print("[INFO] Revit cerrado")\n        return True\n    except Exception as e:\n        print(f"[AVISO] Error al cerrar Revit: {e}")\n        # Intentar con taskkill\n        try:\n            os.system(\'taskkill /F /IM Revit.exe\')\n            print("[INFO] Revit forzosamente cerrado")\n            time.sleep(2)\n            return True\n        except:\n            return False\n\ndef renombrar_archivos(archivos_rfa):\n    """Renombra archivos RFA con nomenclatura en español"""\n    print("\\n[PASO 7] Renombrando archivos...")\n    \n    cambios = []\n    for ruta_completa in archivos_rfa:\n        directorio = os.path.dirname(ruta_completa)\n        nombre_original = os.path.basename(ruta_completa)\n        \n        nombre_nuevo = normalizar_nombre_español(nombre_original) + ".rfa"\n        \n        if nombre_original != nombre_nuevo:\n            ruta_nueva = os.path.join(directorio, nombre_nuevo)\n            try:\n                if os.path.exists(ruta_nueva):\n                    print(f"[AVISO] {nombre_nuevo} ya existe, omitiendo...")\n                else:\n                    os.rename(ruta_completa, ruta_nueva)\n                    cambios.append((nombre_original, nombre_nuevo))\n                    print(f"  ✓ {nombre_original} → {nombre_nuevo}")\n            except Exception as e:\n                print(f"  ✗ Error renombrando {nombre_original}: {e}")\n    \n    return cambios\n\ndef main(ruta_base=None):\n    """Función principal - Automatización completa"""\n    print("=" * 70)\n    print("ACTUALIZADOR AUTOMÁTICO DE FAMILIAS REVIT - DYNAMO MULTIPLAYER v.3.0")\n    print("=" * 70)\n    \n    # Buscar archivos RFA\n    archivos_rfa, ruta_usada = buscar_archivos_rfa(ruta_base)\n    \n    if not archivos_rfa:\n        print("[ERROR] No se encontraron archivos RFA")\n        return\n    \n    print(f"\\n[ÉXITO] Se encontraron {len(archivos_rfa)} archivos RFA")\n    print(f"Ubicación: {ruta_usada}\\n")\n    \n    for archivo in archivos_rfa[:5]:  # Mostrar primeros 5\n        print(f"  - {os.path.basename(archivo)}")\n    if len(archivos_rfa) > 5:\n        print(f"  ... y {len(archivos_rfa) - 5} más\\n")\n    \n    # Crear lista\n    lista_archivos = crear_lista_archivos(archivos_rfa)\n    \n    # Abrir Revit\n    proceso_revit = abrir_revit(timeout=40)\n    if not proceso_revit:\n        print("[CANCELADO] No se pudo abrir Revit")\n        return\n    \n    # Esperar a Dynamo Multiplayer\n    esperar_ventana_dynamo(timeout=30)\n    time.sleep(2)\n    \n    # Introducir lista automáticamente\n    if not introducir_lista_automaticamente(lista_archivos):\n        print("[AVISO] Problema al introducir lista, continuando manualmente...")\n    \n    time.sleep(1)\n    \n    # Hacer clic en Proceed\n    if not hacer_clic_proceder():\n        print("[AVISO] Problema al ejecutar, verifica manualmente")\n        return\n    \n    # Esperar procesamiento (60 minutos)\n    esperar_procesamiento(timeout=3600)\n    \n    # Cerrar Revit\n    time.sleep(5)\n    cerrar_revit_automaticamente()\n    \n    # Renombrar archivos\n    cambios = renombrar_archivos(archivos_rfa)\n    \n    # Resumen final\n    print("\\n" + "=" * 70)\n    print(f"[RESUMEN] Proceso completado")\n    print(f"  - Archivos procesados: {len(archivos_rfa)}")\n    print(f"  - Archivos renombrados: {len(cambios)}")\n    print(f"  - Hora finalización: {datetime.now().strftime(\'%H:%M:%S\')}")\n    print("=" * 70)\n\nif __name__ == "__main__":\n    main()\n', 'descripcion': 'Automatización completa con monitoreo de 60 minutos: busca RFA, abre Revit, introduce lista automáticamente en Dynamo Multiplayer v.3.0, ejecuta proceso, cierra Revit y renombra archivos.', 'nombre': 'revit_dynamo_60min', 'parametros': [{'nombre': 'ruta_base', 'tipo': 'string', 'descripcion': 'Ruta del directorio base (opcional)', 'requerido': False}]}
[2026-02-17 20:00:07] Herramienta creada: FR_revit_dynamo_60min -> C:\Users\frpoz\mcp\herramientas\fr_revit_dynamo_60min.py
[2026-02-17 20:00:07] Ejecucion exitosa: FR_generar_herramienta
[2026-02-17 20:03:45] Ejecutando: FR_listar_herramientas_creadas con args: {}
[2026-02-17 20:03:46] Listadas 9 herramientas
[2026-02-17 20:03:46] Ejecucion exitosa: FR_listar_herramientas_creadas
[2026-02-17 20:16:22] ============================================================
[2026-02-17 20:16:22] Servidor MCP Modular iniciado
[2026-02-17 20:16:22] Directorio de herramientas: C:\Users\frpoz\mcp\herramientas
[2026-02-17 20:16:22] Directorio de logs: C:\Users\frpoz\mcp\logs
[2026-02-17 20:16:22] Buscando herramientas en: C:\Users\frpoz\mcp\herramientas
[2026-02-17 20:16:22] Encontrados 9 archivos
[2026-02-17 20:16:22] ERROR cargando fr_actualizar_familias_revit_dynamo.py: 'return' outside function (fr_actualizar_familias_revit_dynamo.py, line 174)
[2026-02-17 20:16:22] Herramienta cargada: FR_generar_herramienta
[2026-02-17 20:16:22] Herramienta cargada: FR_listar_herramientas_creadas
[2026-02-17 20:16:22] ERROR cargando FR_renombrar_familias2_rfa.py: unterminated string literal (detected at line 846) (FR_renombrar_familias2_rfa.py, line 846)
[2026-02-17 20:16:22] Herramienta cargada: FR_renombrar_familias_rfa
[2026-02-17 20:16:22] Herramienta cargada: FR_FR_renombrar_mayusculas_v2
[2026-02-17 20:16:22] Herramienta cargada: FR_renombrar_mayusculas
[2026-02-17 20:16:22] ERROR cargando fr_revit_dynamo_60min.py: 'return' outside function (fr_revit_dynamo_60min.py, line 314)
[2026-02-17 20:16:22] ERROR cargando fr_revit_dynamo_automatizado_completo.py: 'return' outside function (fr_revit_dynamo_automatizado_completo.py, line 312)
[2026-02-17 20:16:22] Cargadas 5 herramientas exitosamente
[2026-02-17 20:16:22] Total herramientas cargadas: 5
[2026-02-17 20:16:22]   - FR_generar_herramienta
[2026-02-17 20:16:22]   - FR_listar_herramientas_creadas
[2026-02-17 20:16:22]   - FR_renombrar_familias_rfa
[2026-02-17 20:16:22]   - FR_FR_renombrar_mayusculas_v2
[2026-02-17 20:16:22]   - FR_renombrar_mayusculas
[2026-02-17 20:16:25] ============================================================
[2026-02-17 20:16:25] Servidor MCP Modular iniciado
[2026-02-17 20:16:25] Directorio de herramientas: C:\Users\frpoz\mcp\herramientas
[2026-02-17 20:16:25] Directorio de logs: C:\Users\frpoz\mcp\logs
[2026-02-17 20:16:25] Buscando herramientas en: C:\Users\frpoz\mcp\herramientas
[2026-02-17 20:16:25] Encontrados 9 archivos
[2026-02-17 20:16:25] ERROR cargando fr_actualizar_familias_revit_dynamo.py: 'return' outside function (fr_actualizar_familias_revit_dynamo.py, line 174)
[2026-02-17 20:16:25] Herramienta cargada: FR_generar_herramienta
[2026-02-17 20:16:25] Herramienta cargada: FR_listar_herramientas_creadas
[2026-02-17 20:16:25] ERROR cargando FR_renombrar_familias2_rfa.py: unterminated string literal (detected at line 846) (FR_renombrar_familias2_rfa.py, line 846)
[2026-02-17 20:16:25] Herramienta cargada: FR_renombrar_familias_rfa
[2026-02-17 20:16:25] Herramienta cargada: FR_FR_renombrar_mayusculas_v2
[2026-02-17 20:16:25] Herramienta cargada: FR_renombrar_mayusculas
[2026-02-17 20:16:25] ERROR cargando fr_revit_dynamo_60min.py: 'return' outside function (fr_revit_dynamo_60min.py, line 314)
[2026-02-17 20:16:25] ERROR cargando fr_revit_dynamo_automatizado_completo.py: 'return' outside function (fr_revit_dynamo_automatizado_completo.py, line 312)
[2026-02-17 20:16:25] Cargadas 5 herramientas exitosamente
[2026-02-17 20:16:25] Total herramientas cargadas: 5
[2026-02-17 20:16:25]   - FR_generar_herramienta
[2026-02-17 20:16:25]   - FR_listar_herramientas_creadas
[2026-02-17 20:16:25]   - FR_renombrar_familias_rfa
[2026-02-17 20:16:25]   - FR_FR_renombrar_mayusculas_v2
[2026-02-17 20:16:25]   - FR_renombrar_mayusculas
[2026-02-17 20:16:25] Buscando herramientas en: C:\Users\frpoz\mcp\herramientas
[2026-02-17 20:16:25] Encontrados 9 archivos
[2026-02-17 20:16:25] ERROR cargando fr_actualizar_familias_revit_dynamo.py: 'return' outside function (fr_actualizar_familias_revit_dynamo.py, line 174)
[2026-02-17 20:16:25] Herramienta cargada: FR_generar_herramienta
[2026-02-17 20:16:25] Herramienta cargada: FR_listar_herramientas_creadas
[2026-02-17 20:16:25] ERROR cargando FR_renombrar_familias2_rfa.py: unterminated string literal (detected at line 846) (FR_renombrar_familias2_rfa.py, line 846)
[2026-02-17 20:16:25] Herramienta cargada: FR_renombrar_familias_rfa
[2026-02-17 20:16:25] Herramienta cargada: FR_FR_renombrar_mayusculas_v2
[2026-02-17 20:16:25] Herramienta cargada: FR_renombrar_mayusculas
[2026-02-17 20:16:25] ERROR cargando fr_revit_dynamo_60min.py: 'return' outside function (fr_revit_dynamo_60min.py, line 314)
[2026-02-17 20:16:25] ERROR cargando fr_revit_dynamo_automatizado_completo.py: 'return' outside function (fr_revit_dynamo_automatizado_completo.py, line 312)
[2026-02-17 20:16:25] Cargadas 5 herramientas exitosamente
[2026-02-17 20:16:25] Listando 5 herramientas
[2026-02-17 20:29:57] ============================================================
[2026-02-17 20:29:57] Servidor MCP Modular iniciado
[2026-02-17 20:29:57] Directorio de herramientas: C:\Users\frpoz\mcp\herramientas
[2026-02-17 20:29:57] Directorio de logs: C:\Users\frpoz\mcp\logs
[2026-02-17 20:29:57] Buscando herramientas en: C:\Users\frpoz\mcp\herramientas
[2026-02-17 20:29:57] Encontrados 4 archivos
[2026-02-17 20:29:57] Herramienta cargada: FR_generar_herramienta
[2026-02-17 20:29:57] Herramienta cargada: FR_listar_herramientas_creadas
[2026-02-17 20:29:57] Herramienta cargada: FR_renombrar_mayusculas
[2026-02-17 20:29:57] ERROR cargando fr_revit_dynamo_60min.py: 'return' outside function (fr_revit_dynamo_60min.py, line 314)
[2026-02-17 20:29:57] Cargadas 3 herramientas exitosamente
[2026-02-17 20:29:57] Total herramientas cargadas: 3
[2026-02-17 20:29:57]   - FR_generar_herramienta
[2026-02-17 20:29:57]   - FR_listar_herramientas_creadas
[2026-02-17 20:29:57]   - FR_renombrar_mayusculas
[2026-02-17 20:29:57] Buscando herramientas en: C:\Users\frpoz\mcp\herramientas
[2026-02-17 20:29:57] Encontrados 4 archivos
[2026-02-17 20:29:57] Herramienta cargada: FR_generar_herramienta
[2026-02-17 20:29:57] Herramienta cargada: FR_listar_herramientas_creadas
[2026-02-17 20:29:57] Herramienta cargada: FR_renombrar_mayusculas
[2026-02-17 20:29:57] ERROR cargando fr_revit_dynamo_60min.py: 'return' outside function (fr_revit_dynamo_60min.py, line 314)
[2026-02-17 20:29:57] Cargadas 3 herramientas exitosamente
[2026-02-17 20:29:57] Listando 3 herramientas
[2026-02-17 20:30:41] Ejecutando: FR_generar_herramienta con args: {'nombre': 'revit_dynamo_60min', 'descripcion': 'Herramienta para renombrar y actualizar familias en Revit mediante Dynamo. Automatiza el cambio de nombres de familias y actualiza sus propiedades en lotes.', 'parametros': [{'nombre': 'archivo_familias', 'tipo': 'string', 'descripcion': 'Ruta del archivo Revit con las familias a renombrar', 'requerido': True}, {'nombre': 'mapeo_nombres', 'tipo': 'object', 'descripcion': 'Diccionario con nombre_actual: nombre_nuevo', 'requerido': True}, {'nombre': 'actualizar_parametros', 'tipo': 'boolean', 'descripcion': 'Si True, actualiza parámetros compartidos de las familias', 'requerido': False}, {'nombre': 'parametros_cambio', 'tipo': 'object', 'descripcion': 'Diccionario de parámetro: nuevo_valor a aplicar', 'requerido': False}], 'codigo_funcion': 'import clr\nclr.AddReference(\'ProtoGeometry\')\nclr.AddReference(\'RevitAPI\')\nclr.AddReference(\'RevitAPIUI\')\n\nfrom Revit.Elements import *\nimport Revit\nimport revit\n\n# Obtener documento activo\ndoc = revit.ActiveDBDocument\n\ndef renombrar_familias(mapeo_nombres):\n    """Renombra familias en el documento"""\n    resultados = []\n    \n    # Obtener todas las familias del documento\n    from Autodesk.Revit.DB import Family\n    collector = Autodesk.Revit.DB.FilteredElementCollector(doc)\n    familias = collector.OfClass(Family).ToElements()\n    \n    for familia in familias:\n        nombre_actual = familia.Name\n        \n        if nombre_actual in mapeo_nombres:\n            nombre_nuevo = mapeo_nombres[nombre_actual]\n            try:\n                # Crear transacción para renombrar\n                t = Autodesk.Revit.DB.Transaction(doc, f"Renombrar {nombre_actual}")\n                t.Start()\n                familia.Name = nombre_nuevo\n                t.Commit()\n                \n                resultados.append({\n                    "exito": True,\n                    "anterior": nombre_actual,\n                    "nuevo": nombre_nuevo,\n                    "mensaje": f"Familia renombrada: {nombre_actual} → {nombre_nuevo}"\n                })\n            except Exception as e:\n                resultados.append({\n                    "exito": False,\n                    "anterior": nombre_actual,\n                    "nuevo": nombre_nuevo,\n                    "mensaje": f"Error: {str(e)}"\n                })\n    \n    return resultados\n\ndef actualizar_parametros_familia(parametros_cambio):\n    """Actualiza parámetros de las familias"""\n    resultados = []\n    \n    collector = Autodesk.Revit.DB.FilteredElementCollector(doc)\n    familias = collector.OfClass(Family).ToElements()\n    \n    for familia in familias:\n        try:\n            # Abre el documento de la familia\n            familia_doc = doc.EditFamily(familia)\n            t = Autodesk.Revit.DB.Transaction(familia_doc, "Actualizar parámetros")\n            t.Start()\n            \n            for param_name, param_value in parametros_cambio.items():\n                # Buscar parámetro compartido\n                param = familia_doc.GetElement(param_name)\n                if param:\n                    param.Set(param_value)\n            \n            t.Commit()\n            familia_doc.Close(True)\n            \n            resultados.append({\n                "exito": True,\n                "familia": familia.Name,\n                "mensaje": f"Parámetros actualizados: {familia.Name}"\n            })\n        except Exception as e:\n            resultados.append({\n                "exito": False,\n                "familia": familia.Name,\n                "mensaje": f"Error: {str(e)}"\n            })\n    \n    return resultados\n\n# Ejecutar funciones\nresultados_renombre = renombrar_familias(mapeo_nombres)\nresultados_parametros = []\n\nif actualizar_parametros:\n    resultados_parametros = actualizar_parametros_familia(parametros_cambio)\n\nsalida = {\n    "renombrados": resultados_renombre,\n    "parametros_actualizados": resultados_parametros,\n    "resumen": {\n        "total_familias_procesadas": len(resultados_renombre),\n        "exitosas": sum(1 for r in resultados_renombre if r["exito"])\n    }\n}\n\nOUT = salida'}
[2026-02-17 20:30:41] Herramienta creada: FR_revit_dynamo_60min -> C:\Users\frpoz\mcp\herramientas\fr_revit_dynamo_60min.py
[2026-02-17 20:30:41] Ejecucion exitosa: FR_generar_herramienta
[2026-02-17 20:35:24] Ejecutando: FR_listar_herramientas_creadas con args: {}
[2026-02-17 20:35:24] Listadas 4 herramientas
[2026-02-17 20:35:24] Ejecucion exitosa: FR_listar_herramientas_creadas
[2026-02-17 20:45:34] Ejecutando: FR_generar_herramienta con args: {'nombre': 'revit_dynamo_60min', 'descripcion': 'Automatización completa con monitoreo de 60 minutos: busca RFA, abre Revit, introduce lista automáticamente en Dynamo Multiplayer v.3.0, ejecuta proceso, cierra Revit y renombra archivos.', 'parametros': [{'nombre': 'ruta_base', 'tipo': 'string', 'descripcion': 'Ruta del directorio con archivos RFA (opcional - abrirá diálogo si no se proporciona)', 'requerido': False}, {'nombre': 'modo_simulacion', 'tipo': 'boolean', 'descripcion': 'Simula el proceso sin ejecutar acciones reales', 'requerido': False}], 'codigo_funcion': 'import os\nimport subprocess\nimport tkinter as tk\nfrom tkinter import filedialog\nimport time\nimport sys\n\ntry:\n    import pyautogui\n    PYAutogui_AVAILABLE = True\nexcept ImportError:\n    PYAutogui_AVAILABLE = False\n\ntry:\n    import pyperclip\n    PYPECLIP_AVAILABLE = True\nexcept ImportError:\n    PYPECLIP_AVAILABLE = False\n\nfrom datetime import datetime\n\ndef normalizar_nombre_español(nombre):\n    """Convierte nombre a formato: Primera letra mayúscula, resto minúsculas"""\n    try:\n        nombre_sin_ext = nombre.rsplit(\'.\', 1)[0] if \'.\' in nombre else nombre\n        if not nombre_sin_ext:\n            return ""\n        nombre_normalizado = nombre_sin_ext[0].upper() + nombre_sin_ext[1:].lower()\n        return nombre_normalizado\n    except Exception as e:\n        print(f"[ERROR] Normalizando nombre {nombre}: {e}")\n        return nombre\n\ndef buscar_archivos_rfa(ruta_base=None):\n    """Busca archivos .rfa en directorio y subdirectorios"""\n    try:\n        if not ruta_base:\n            try:\n                root = tk.Tk()\n                root.withdraw()\n                ruta_base = filedialog.askdirectory(title="Selecciona la carpeta con archivos RFA")\n                root.destroy()\n            except:\n                print("[ERROR] No se puede abrir diálogo gráfico.")\n                return [], None\n        \n        if not ruta_base or not os.path.exists(ruta_base):\n            print(f"[ERROR] La ruta no existe: {ruta_base}")\n            return [], None\n        \n        archivos_rfa = []\n        for root, dirs, files in os.walk(ruta_base):\n            for file in files:\n                if file.lower().endswith(\'.rfa\'):\n                    ruta_completa = os.path.join(root, file)\n                    archivos_rfa.append(ruta_completa)\n        \n        return sorted(archivos_rfa), ruta_base\n    except Exception as e:\n        print(f"[ERROR] Buscando archivos RFA: {e}")\n        return [], None\n\ndef crear_lista_archivos(archivos_rfa):\n    """Crea lista de archivos en formato texto"""\n    return "\\n".join(archivos_rfa)\n\ndef abrir_revit(timeout=30, modo_simulacion=False):\n    """Abre Revit y espera a que cargue"""\n    print("[PASO 1] Abriendo Revit...")\n    \n    if modo_simulacion:\n        print("[SIMULACIÓN] Simulando apertura de Revit")\n        return True\n    \n    revit_paths = [\n        r"C:\\Program Files\\Autodesk\\Revit 2026\\Revit.exe",\n        r"C:\\Program Files\\Autodesk\\Revit 2025\\Revit.exe",\n        r"C:\\Program Files\\Autodesk\\Revit 2024\\Revit.exe",\n        r"C:\\Program Files\\Autodesk\\Revit 2023\\Revit.exe",\n    ]\n    \n    revit_exe = None\n    for path in revit_paths:\n        if os.path.exists(path):\n            revit_exe = path\n            break\n    \n    if not revit_exe:\n        print("[ERROR] No se encontró Revit instalado")\n        return None\n    \n    try:\n        proceso = subprocess.Popen([revit_exe])\n        print(f"[INFO] Revit iniciado (PID: {proceso.pid}). Esperando {timeout} segundos...")\n        for i in range(timeout):\n            time.sleep(1)\n            if i % 10 == 0:\n                print(f"[INFO] Esperando... {timeout - i}s restantes")\n        return proceso\n    except Exception as e:\n        print(f"[ERROR] No se pudo abrir Revit: {e}")\n        return None\n\ndef esperar_ventana_dynamo(timeout=20, modo_simulacion=False):\n    """Espera a que aparezca Dynamo Multiplayer"""\n    print("[PASO 2] Esperando ventana de Dynamo Multiplayer...")\n    \n    if modo_simulacion or not PYAutogui_AVAILABLE:\n        print("[SIMULACIÓN] Simulando espera de ventana Dynamo")\n        time.sleep(2)\n        return True\n    \n    inicio = time.time()\n    while time.time() - inicio < timeout:\n        try:\n            ventanas = pyautogui.getAllWindows()\n            for ventana in ventanas:\n                if "Dynamo Multiplayer" in ventana.title:\n                    print(f"[INFO] Ventana encontrada: {ventana.title}")\n                    ventana.activate()\n                    time.sleep(1)\n                    return True\n        except Exception as e:\n            print(f"[AVISO] Error buscando ventanas: {e}")\n        time.sleep(0.5)\n    \n    print("[AVISO] Ventana no encontrada automáticamente")\n    return False\n\ndef introducir_lista_automaticamente(lista_archivos, modo_simulacion=False):\n    """Introduce lista de archivos en Dynamo Multiplayer"""\n    print("[PASO 3] Introduciendo lista de archivos...")\n    \n    if modo_simulacion:\n        print(f"[SIMULACIÓN] Lista simulada ({len(lista_archivos.splitlines())} archivos)")\n        return True\n    \n    try:\n        if PYPECLIP_AVAILABLE:\n            pyperclip.copy(lista_archivos)\n            print("[INFO] Lista copiada al portapapeles")\n        \n        if PYAutogui_AVAILABLE:\n            time.sleep(0.5)\n            pyautogui.click(610, 300)\n            time.sleep(0.5)\n            pyautogui.hotkey(\'ctrl\', \'a\')\n            time.sleep(0.3)\n            pyautogui.hotkey(\'ctrl\', \'v\')\n            print("[INFO] Lista introducida")\n            return True\n    except Exception as e:\n        print(f"[ERROR] Error introduciendo lista: {e}")\n    return False\n\ndef hacer_clic_proceder(modo_simulacion=False):\n    """Clickea el botón Proceed"""\n    print("[PASO 4] Ejecutando proceso...")\n    \n    if modo_simulacion or not PYAutogui_AVAILABLE:\n        print("[SIMULACIÓN] Simulando clic en botón Proceed")\n        return True\n    \n    try:\n        pyautogui.click(793, 769)\n        print("[INFO] Botón \'Proceed\' clickeado")\n        time.sleep(2)\n        return True\n    except Exception as e:\n        print(f"[ERROR] Error al hacer clic: {e}")\n        return False\n\ndef esperar_procesamiento(timeout=3600, modo_simulacion=False):\n    """Espera a que termine el procesamiento (máx 60 minutos)"""\n    print(f"[PASO 5] Procesando archivos (máx {timeout//60} minutos)...")\n    \n    if modo_simulacion:\n        print("[SIMULACIÓN] Simulando procesamiento (5 segundos)")\n        time.sleep(5)\n        return True\n    \n    inicio = time.time()\n    ultimo_log = 0\n    \n    while time.time() - inicio < timeout:\n        try:\n            if PYAutogui_AVAILABLE:\n                ventanas = pyautogui.getAllWindows()\n                dynamo_visible = any("Dynamo Multiplayer" in v.title for v in ventanas)\n                \n                if not dynamo_visible:\n                    print("[INFO] Ventana de Dynamo cerrada - procesamiento completado")\n                    return True\n        except:\n            pass\n        \n        tiempo_transcurrido = int(time.time() - inicio)\n        \n        if tiempo_transcurrido - ultimo_log >= 30:\n            minutos = tiempo_transcurrido // 60\n            segundos = tiempo_transcurrido % 60\n            print(f"[INFO] Procesando... {minutos}m {segundos}s")\n            ultimo_log = tiempo_transcurrido\n        \n        time.sleep(1)\n    \n    print("[AVISO] Timeout de 60 minutos alcanzado")\n    return True\n\ndef cerrar_revit_automaticamente(modo_simulacion=False):\n    """Cierra Revit automáticamente"""\n    print("[PASO 6] Cerrando Revit...")\n    \n    if modo_simulacion:\n        print("[SIMULACIÓN] Simulando cierre de Revit")\n        return True\n    \n    try:\n        if PYAutogui_AVAILABLE:\n            pyautogui.hotkey(\'alt\', \'F4\')\n            time.sleep(1)\n            pyautogui.press(\'tab\')\n            time.sleep(0.3)\n            pyautogui.press(\'enter\')\n            time.sleep(2)\n            print("[INFO] Revit cerrado")\n            return True\n        else:\n            os.system(\'taskkill /F /IM Revit.exe\')\n            print("[INFO] Revit forzosamente cerrado")\n            time.sleep(2)\n            return True\n    except Exception as e:\n        print(f"[AVISO] Error al cerrar Revit: {e}")\n        try:\n            os.system(\'taskkill /F /IM Revit.exe\')\n            print("[INFO] Revit forzosamente cerrado")\n            return True\n        except:\n            return False\n\ndef renombrar_archivos(archivos_rfa, modo_simulacion=False):\n    """Renombra archivos RFA"""\n    print("\\n[PASO 7] Renombrando archivos...")\n    \n    cambios = []\n    for ruta_completa in archivos_rfa:\n        try:\n            directorio = os.path.dirname(ruta_completa)\n            nombre_original = os.path.basename(ruta_completa)\n            \n            nombre_sin_ext = normalizar_nombre_español(nombre_original)\n            if not nombre_sin_ext:\n                continue\n                \n            nombre_nuevo = nombre_sin_ext + ".rfa"\n            \n            if nombre_original != nombre_nuevo:\n                ruta_nueva = os.path.join(directorio, nombre_nuevo)\n                \n                if modo_simulacion:\n                    cambios.append((nombre_original, nombre_nuevo))\n                    print(f"  [SIM] {nombre_original} → {nombre_nuevo}")\n                else:\n                    if os.path.exists(ruta_nueva):\n                        print(f"  [AVISO] {nombre_nuevo} ya existe")\n                    else:\n                        os.rename(ruta_completa, ruta_nueva)\n                        cambios.append((nombre_original, nombre_nuevo))\n                        print(f"  ✓ {nombre_original} → {nombre_nuevo}")\n        except Exception as e:\n            print(f"  ✗ Error: {e}")\n    \n    return cambios\n\nasync def ejecutar(argumentos):\n    """Ejecuta la herramienta"""\n    ruta_base = argumentos.get("ruta_base", "")\n    modo_simulacion = argumentos.get("modo_simulacion", False)\n    \n    resultado = []\n    \n    def log(msg):\n        print(msg)\n        resultado.append(msg)\n    \n    log("=" * 70)\n    log("ACTUALIZADOR AUTOMÁTICO DE FAMILIAS REVIT - DYNAMO MULTIPLAYER v.3.0")\n    if modo_simulacion:\n        log("MODO SIMULACIÓN")\n    log("=" * 70)\n    \n    archivos_rfa, ruta_usada = buscar_archivos_rfa(ruta_base if ruta_base else None)\n    \n    if not archivos_rfa:\n        log("[ERROR] No se encontraron archivos RFA")\n        return "\\n".join(resultado)\n    \n    log(f"\\n[ÉXITO] Se encontraron {len(archivos_rfa)} archivos RFA")\n    log(f"Ubicación: {ruta_usada}\\n")\n    \n    for i, archivo in enumerate(archivos_rfa[:5]):\n        log(f"  {i+1}. {os.path.basename(archivo)}")\n    if len(archivos_rfa) > 5:\n        log(f"  ... y {len(archivos_rfa) - 5} más\\n")\n    \n    lista_archivos = crear_lista_archivos(archivos_rfa)\n    \n    proceso_revit = abrir_revit(timeout=40, modo_simulacion=modo_simulacion)\n    if not proceso_revit and not modo_simulacion:\n        log("[CANCELADO] No se pudo abrir Revit")\n        return "\\n".join(resultado)\n    \n    esperar_ventana_dynamo(timeout=30, modo_simulacion=modo_simulacion)\n    time.sleep(2)\n    \n    introducir_lista_automaticamente(lista_archivos, modo_simulacion)\n    time.sleep(1)\n    \n    hacer_clic_proceder(modo_simulacion)\n    \n    esperar_procesamiento(timeout=3600, modo_simulacion=modo_simulacion)\n    \n    time.sleep(5)\n    cerrar_revit_automaticamente(modo_simulacion)\n    \n    cambios = renombrar_archivos(archivos_rfa, modo_simulacion)\n    \n    log("\\n" + "=" * 70)\n    log(f"[RESUMEN] Proceso completado")\n    log(f"  - Archivos procesados: {len(archivos_rfa)}")\n    log(f"  - Archivos renombrados: {len(cambios)}")\n    log(f"  - Hora finalización: {datetime.now().strftime(\'%H:%M:%S\')}")\n    log("=" * 70)\n    \n    return "\\n".join(resultado)\n'}
[2026-02-17 20:45:34] Herramienta creada: FR_revit_dynamo_60min -> C:\Users\frpoz\mcp\herramientas\fr_revit_dynamo_60min.py
[2026-02-17 20:45:34] Ejecucion exitosa: FR_generar_herramienta
